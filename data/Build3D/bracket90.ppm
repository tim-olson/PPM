// File: bracket90.ppm
// Description: 3D 90Â° angle bracket from a 2D L-profile extruded in +Z (robust fillet)
// Author: Tim Olson
// Date: 2025-09-05

Units(1[in]);  // Work in inches

// ---------------- Parameters ----------------
Input(A, B, t, Len, Ri);

// Leg spans along +X and +Y, leg thickness, extrusion length
A   = Parameter("Leg A (X extent)", 4.0, LINEAR, GreaterThan(0));
B   = Parameter("Leg B (Y extent)", 3.0, LINEAR, GreaterThan(0));
t   = Parameter("Leg Thickness",     0.5, LINEAR, Interval(0.01, min(A, B) * 0.49));
Len = Parameter("Extrusion Length",  2.0, LINEAR, GreaterThan(0));

// Fillet at the re-entrant inside corner (p3).
// IMPORTANT: For a 90Â° corner, Ri must be strictly >0 and < min(A - t, B - t).
// Constrain it so the UI never feeds Fillet() an invalid radius.
Ri  = Parameter(
       "Inside Fillet Radius",
       min(A, B) * 0.1,                  // sensible default
       LINEAR,
       Interval(0.01, min(A - t, B - t) - 0.01)
     );

// ---------------- 2D L-profile (closed polyline) ----------------
// CCW loop with inside corner at p3
p0 = Point(0, 0);
p1 = Point(A, 0);
p2 = Point(A, t);
p3 = Point(t, t);          // inside (re-entrant) corner to be filleted
p4 = Point(t, B);
p5 = Point(0, B);
p6 = p0;                   // close loop

// Fillet is inserted AFTER the vertex to be rounded (here, after p3).
profile2D = Polyline(
  p0,
  p1,
  p2,
  p3, Fillet(Ri),          // round the inside corner; Ri is guaranteed valid by Interval(...)
  p4,
  p5,
  p6
);

// ---------------- Extrude into 3D ----------------
bracket = Thickness(profile2D, Len);   // prism in +Z by Len

// ---------------- Output ----------------
Output(bracket);
